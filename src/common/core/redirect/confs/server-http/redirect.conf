{% set redirects = namespace() %}
{% set redirects.list = [] %}
{% for k, v in all.items() %}
    {% if k.startswith("REDIRECT_TO") and v != "" %}
        {% set suffix = k[11:] %}
        {% if not suffix or suffix.startswith("_") %}
            {% set index_str = suffix[1:] if suffix else "0" %}
            {% if index_str.isdigit() %}
                {% set index = index_str|int %}
                {% set redirects.list = redirects.list + [(index, k, v)] %}
            {% endif %}
        {% endif %}
    {% endif %}
{% endfor %}
{% for index, k, to in redirects.list|sort %}
    {% set suffix = "_" ~ index if index > 0 else "" %}
    {% set from = all["REDIRECT_FROM" ~ suffix] if "REDIRECT_FROM" ~ suffix in all else "/" %}
    {% set request_uri = all["REDIRECT_TO_REQUEST_URI" ~ suffix] if "REDIRECT_TO_REQUEST_URI" ~ suffix in all else "no" %}
    {% set status_code = all["REDIRECT_TO_STATUS_CODE" ~ suffix] if "REDIRECT_TO_STATUS_CODE" ~ suffix in all else "301" %}
location {{ from }} {
	{% if request_uri == "yes" %}
	return {{ status_code }} {{ to }}$request_uri;
	{% else %}
	return {{ status_code }} {{ to }};
	{% endif %}
}
{% endfor %}
